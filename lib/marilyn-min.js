(function(){function n(e){return t[e]}function r(n,r){function s(e){function n(){i.updateSilent({__id:t.id},t,function(e,t){var n=t[0];if(i._afters.hasOwnProperty("save")){i._retainScope=i._afters["save"];i._retainScope(n,function(){r(e,n)})}else{r(e,n)}})}function r(t,n){i.inform("save",n);if(e){i._retainScope=e;i._retainScope(t,n)}}var t=this;if(i._befores.hasOwnProperty("save")){i._retainScope=i._befores["save"];i._retainScope(t,function(){n()})}else{n()}}var i=t[n]={};i.name=n;i._collection=[];i._id=0;i._befores={};i._afters={};i._receivers={};i._retainScope=function(){};i._nextId=function(){i._id++;return i._id};i.on=function(t,n){if(e){e.on(t,function(e){i._retainScope=n;i._retainScope(e)})}};i.emit=function(t,n){if(e){e.emit(t,n)}};i.before=function(e,t){i._befores[e]=t};i.beforeRemove=function(e){i._befores[e]=function(){}};i.after=function(e,t){i._afters[e]=t};i.afterRemove=function(e){i._afters[e]=function(){}};i.inform=function(e,t){if(i._receivers[e]){i._retainScope=i._receivers[e];i._retainScope(t)}};i.receive=function(e,t){i._receivers[e]=t};i.receiveRemove=function(e){if(_.isEmpty(e)){i._receivers={}}else{i._receivers[e]=function(){}}};i.collection=function(e){if(!_.isArray(e)){return}for(var t=0,n=e.length;t<n;t++){e[t].__id=i._nextId()}i._collection=e};i.create=function(e,t){function n(){i.createSilent(e,function(t,n){if(i._afters.hasOwnProperty("create")){i._retainScope=i._afters["create"];i._retainScope(e,function(){r(t,n)})}else{r(t,n)}})}function r(e,n){i.inform("create",n);if(t){i._retainScope=t;i._retainScope(e,n)}}if(i._befores.hasOwnProperty("create")){i._retainScope=i._befores["create"];i._retainScope(e,function(){n()})}else{n()}};i.createSilent=function(e,t){var n=null;e.__id=i._nextId();i._collection.push(e);if(t){i._retainScope=t;i._retainScope(n,e)}};i.read=function(e,t){function n(){i.readSilent(e,function(e,t){if(i._afters.hasOwnProperty("read")){i._retainScope=i._afters["read"];i._retainScope(t,function(){r(e,t)})}else{r(e,t)}})}function r(e,n){i.inform("read",n);if(t){i._retainScope=t;i._retainScope(e,n)}}if(i._befores.hasOwnProperty("read")){i._retainScope=i._befores["read"];i._retainScope(e,function(){n()})}else{n()}};i.readSilent=function(e,t){var n=null;var r=false;if(typeof e==="function"){t=e;r=true}else if(_.isEmpty(e)){r=true}var o=[];if(r){o=i._collection}else{o=_.where(i._collection,e)}if(o.length==0){n="item not found"}_.each(o,function(e){e.save=s});if(t){i._retainScope=t;i._retainScope(n,o)}};i.readOne=function(e,t){function n(){i.readOneSilent(e,function(e,t){if(i._afters.hasOwnProperty("readOne")){i._retainScope=i._afters["readOne"];i._retainScope(t,function(){r(e,t)})}else{r(e,t)}})}function r(e,n){i.inform("readOne",n);if(t){i._retainScope=t;i._retainScope(e,n)}}if(i._befores.hasOwnProperty("readOne")){i._retainScope=i._befores["readOne"];i._retainScope(e,function(){n()})}else{n()}};i.readOneSilent=function(e,t){var n=null;var r=_.where(i._collection,e);var o=null;if(r[0]){o=r[0];o.save=s}else{n="item not found"}if(t){i._retainScope=t;i._retainScope(n,o)}};i.update=function(e,t,n){function r(){i.updateSilent(e,t,function(e,t){if(i._afters.hasOwnProperty("update")){i._retainScope=i._afters["update"];i._retainScope(t,function(){s(e,t)})}else{s(e,t)}})}function s(e,t){i.inform("update",t);if(n){i._retainScope=n;i._retainScope(e,t)}}if(i._befores.hasOwnProperty("update")){i._retainScope=i._befores["update"];i._retainScope(e,t,function(){r()})}else{r()}};i.updateSilent=function(e,t,n){var r=null;var s=_.where(i._collection,e);if(s.length>0){_.each(s,function(e){_.each(t,function(t,n){e[n]=t})})}else{r="item not found"}if(n){i._retainScope=n;i._retainScope(r,s)}};i.del=i["delete"]=function(e,t){function n(){i.deleteSilent(e,function(e,t){if(i._afters.hasOwnProperty("delete")){i._retainScope=i._afters["delete"];i._retainScope(t,function(){r(e,t)})}else{r(e,t)}})}function r(e,n){i.inform("delete",n);if(t){i._retainScope=t;i._retainScope(e,n)}}if(i._befores.hasOwnProperty("delete")){i._retainScope=i._befores["delete"];i._retainScope(e,function(){n()})}else{n()}};i.delSilent=i.deleteSilent=function(e,t){var n=null;var r=_.where(i._collection,e);if(r.length>0){_.each(r,function(e){var t=_.indexOf(i._collection,e);i._collection.splice(t,1)})}else{n="item not found"}if(t){i._retainScope=t;i._retainScope(n,r)}};if(r){i.init=r;i.init();delete i.init}return i}var e;var t={};var i={};i.VERSION="0.7.2";i.config=function(t){e=t};i.model=function(e,i){if(t[e]){return n(e)}else{return r(e,i)}};i.modelRemove=function(e){t[e]=null};i.receiveRemove=function(e){for(var n in t){t[n].receiveRemove()}};window.Marilyn=i})()