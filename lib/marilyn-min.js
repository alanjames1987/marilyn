(function(){function n(e){return t[e]}function r(n,r){var i=t[n]={};i.name=n;i._collection=[];i._befores={};i._afters={};i._receivers={};i._retainScope;i.on=function(t,n){if(e){e.on(t,function(e){i._retainScope=n;i._retainScope(e)})}};i.emit=function(t,n){if(e){e.emit(t,n)}};i.before=function(e,t){i._befores[e]=t};i.beforeRemove=function(e){i._befores[e]=function(){}};i.after=function(e,t){i._afters[e]=t};i.afterRemove=function(e){i._afters[e]=function(){}};i.inform=function(e,t){if(i._receivers[e]){i._retainScope=i._receivers[e];i._retainScope(t)}};i.receive=function(e,t){i._receivers[e]=t};i.receiveRemove=function(e){if(_.isEmpty(e)){i._receivers={}}else{i._receivers[e]=function(){}}};i.create=function(e,t){function n(){i.createSilent(e,function(t,n){if(i._afters.hasOwnProperty("create")){i._retainScope=i._afters["create"];i._retainScope(e,function(){r(t,n)})}else{r(t,n)}})}function r(e,n){if(t){i._retainScope=t;i._retainScope(e,n)}}if(i._befores.hasOwnProperty("create")){i._retainScope=i._befores["create"];i._retainScope(e,function(){n()})}else{n()}};i.createSilent=function(e,t){var n=null;i._collection.push(e);i.inform("create",e);if(t){i._retainScope=t;i._retainScope(n,e)}};i.read=function(e,t){function n(){i.readSilent(e,function(e,t){if(i._afters.hasOwnProperty("read")){i._retainScope=i._afters["read"];i._retainScope(t,function(){r(e,t)})}else{r(e,t)}})}function r(e,n){if(t){i._retainScope=t;i._retainScope(e,n)}}if(i._befores.hasOwnProperty("read")){i._retainScope=i._befores["read"];i._retainScope(e,function(){n()})}else{n()}};i.readSilent=function(e,t){var n=null;var r=false;if(typeof e==="function"){t=e;r=true}else if(_.isEmpty(e)){r=true}var s=[];if(r){s=i._collection}else{s=_.where(i._collection,e)}i.inform("read",s);if(t){i._retainScope=t;i._retainScope(n,s)}};i.readOne=function(e,t){function n(){i.readOneSilent(e,function(e,t){if(i._afters.hasOwnProperty("readOne")){i._retainScope=i._afters["readOne"];i._retainScope(t,function(){r(e,t)})}else{r(e,t)}})}function r(e,n){if(t){i._retainScope=t;i._retainScope(e,n)}}if(i._befores.hasOwnProperty("readOne")){i._retainScope=i._befores["readOne"];i._retainScope(function(){n()})}else{n()}};i.readOneSilent=function(e,t){var n=null;var r=_.where(i._collection,e);var s=null;if(r[0]){s=r[0]}else{n="item not found"}i.inform("readOne",r);if(t){i._retainScope=t;i._retainScope(n,s)}};i.update=function(e,t,n){function r(){i.updateSilent(e,t,function(e,t){if(i._afters.hasOwnProperty("update")){i._retainScope=i._afters["update"];i._retainScope(t,function(){s(e,t)})}else{s(e,t)}})}function s(e,t){if(n){i._retainScope=n;i._retainScope(e,t)}}if(i._befores.hasOwnProperty("update")){i._retainScope=i._befores["update"];i._retainScope(function(){r()})}else{r()}};i.updateSilent=function(e,t,n){var r=null;var s=_.where(i._collection,e);if(s){_.each(s,function(e){_.each(t,function(t,n){e[n]=t})});i.inform("update",s)}else{r="item not found"}if(n){i._retainScope=n;i._retainScope(r,s)}};i.del=i["delete"]=function(e,t){function n(){i.deleteSilent(e,function(e,t){if(i._afters.hasOwnProperty("delete")){i._retainScope=i._afters["delete"];i._retainScope(t,function(){r(e,t)})}else{r(e,t)}})}function r(e,n){if(t){i._retainScope=t;i._retainScope(e,n)}}if(i._befores.hasOwnProperty("delete")){i._retainScope=i._befores["delete"];i._retainScope(function(){n()})}else{n()}};i.delSilent=i.deleteSilent=function(e,t){var n=null;var r=_.where(i._collection,e);if(r){_.each(r,function(e){var t=_.indexOf(i._collection,e);i._collection.splice(t,1)});i.inform("delete",r)}else{n="item not found"}if(t){i._retainScope=t;i._retainScope(n,r)}};if(r){i.init=r;i.init();delete i.init}return i}var e;var t={};var i={};i.VERSION="0.6.1";i.config=function(t){e=t};i.model=function(e,i){if(t[e]){return n(e)}else{return r(e,i)}};i.modelRemove=function(e){t[e]=null};i.receiveRemove=function(e){for(var n in t){t[n].receiveRemove()}};window.Marilyn=i})()