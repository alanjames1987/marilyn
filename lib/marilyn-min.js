(function(){function n(e){function n(){model.updateSilent({__id:t.id},t,function(e,t){var n=t[0];if(model._afters.hasOwnProperty("save")){model._retainScope=model._afters["save"];model._retainScope(n,function(){r(e,n)})}else{r(e,n)}})}function r(t,n){model.inform("save",n);if(e){model._retainScope=e;model._retainScope(t,n)}}var t=this;if(model._befores.hasOwnProperty("save")){model._retainScope=model._befores["save"];model._retainScope(t,function(){n()})}else{n()}}function r(e){return t[e]}function i(r,i){var s=t[r]={};s.name=r;s._collection=[];s._id=0;s._befores={};s._afters={};s._receivers={};s._retainScope=function(){};s._nextId=function(){s._id++;return s._id};s.on=function(t,n){if(e){e.on(t,function(e){s._retainScope=n;s._retainScope(e)})}};s.emit=function(t,n){if(e){e.emit(t,n)}};s.before=function(e,t){s._befores[e]=t};s.beforeRemove=function(e){s._befores[e]=function(){}};s.after=function(e,t){s._afters[e]=t};s.afterRemove=function(e){s._afters[e]=function(){}};s.inform=function(e,t){if(s._receivers[e]){s._retainScope=s._receivers[e];s._retainScope(t)}};s.receive=function(e,t){s._receivers[e]=t};s.receiveRemove=function(e){if(_.isEmpty(e)){s._receivers={}}else{s._receivers[e]=function(){}}};s.collection=function(e){if(!_.isArray(e)){return}for(var t=0,n=e.length;t<n;t++){e[t].__id=s._nextId()}s._collection=e};s.create=function(e,t){function n(){s.createSilent(e,function(t,n){if(s._afters.hasOwnProperty("create")){s._retainScope=s._afters["create"];s._retainScope(e,function(){r(t,n)})}else{r(t,n)}})}function r(e,n){s.inform("create",n);if(t){s._retainScope=t;s._retainScope(e,n)}}if(s._befores.hasOwnProperty("create")){s._retainScope=s._befores["create"];s._retainScope(e,function(){n()})}else{n()}};s.createSilent=function(e,t){var n=null;e.__id=s._nextId();s._collection.push(e);if(t){s._retainScope=t;s._retainScope(n,e)}};s.read=function(e,t){function n(){s.readSilent(e,function(e,t){if(s._afters.hasOwnProperty("read")){s._retainScope=s._afters["read"];s._retainScope(t,function(){r(e,t)})}else{r(e,t)}})}function r(e,n){s.inform("read",n);if(t){s._retainScope=t;s._retainScope(e,n)}}if(s._befores.hasOwnProperty("read")){s._retainScope=s._befores["read"];s._retainScope(e,function(){n()})}else{n()}};s.readSilent=function(e,t){var r=null;var i=false;if(typeof e==="function"){t=e;i=true}else if(_.isEmpty(e)){i=true}var o=[];if(i){o=s._collection}else{o=_.where(s._collection,e)}if(o.length==0){r="item not found"}_.each(o,function(e){e.save=n});if(t){s._retainScope=t;s._retainScope(r,o)}};s.readOne=function(e,t){function n(){s.readOneSilent(e,function(e,t){if(s._afters.hasOwnProperty("readOne")){s._retainScope=s._afters["readOne"];s._retainScope(t,function(){r(e,t)})}else{r(e,t)}})}function r(e,n){s.inform("readOne",n);if(t){s._retainScope=t;s._retainScope(e,n)}}if(s._befores.hasOwnProperty("readOne")){s._retainScope=s._befores["readOne"];s._retainScope(e,function(){n()})}else{n()}};s.readOneSilent=function(e,t){var r=null;var i=_.where(s._collection,e);var o=null;if(i[0]){o=i[0];o.save=n}else{r="item not found"}if(t){s._retainScope=t;s._retainScope(r,o)}};s.update=function(e,t,n){function r(){s.updateSilent(e,t,function(e,t){if(s._afters.hasOwnProperty("update")){s._retainScope=s._afters["update"];s._retainScope(t,function(){i(e,t)})}else{i(e,t)}})}function i(e,t){s.inform("update",t);if(n){s._retainScope=n;s._retainScope(e,t)}}if(s._befores.hasOwnProperty("update")){s._retainScope=s._befores["update"];s._retainScope(e,t,function(){r()})}else{r()}};s.updateSilent=function(e,t,n){var r=null;var i=_.where(s._collection,e);if(i.length>0){_.each(i,function(e){_.each(t,function(t,n){e[n]=t})})}else{r="item not found"}if(n){s._retainScope=n;s._retainScope(r,i)}};s.del=s["delete"]=function(e,t){function n(){s.deleteSilent(e,function(e,t){if(s._afters.hasOwnProperty("delete")){s._retainScope=s._afters["delete"];s._retainScope(t,function(){r(e,t)})}else{r(e,t)}})}function r(e,n){s.inform("delete",n);if(t){s._retainScope=t;s._retainScope(e,n)}}if(s._befores.hasOwnProperty("delete")){s._retainScope=s._befores["delete"];s._retainScope(e,function(){n()})}else{n()}};s.delSilent=s.deleteSilent=function(e,t){var n=null;var r=_.where(s._collection,e);if(r.length>0){_.each(r,function(e){var t=_.indexOf(s._collection,e);s._collection.splice(t,1)})}else{n="item not found"}if(t){s._retainScope=t;s._retainScope(n,r)}};if(i){s.init=i;s.init();delete s.init}return s}var e;var t={};var s={};s.VERSION="0.7.1";s.config=function(t){e=t};s.model=function(e,n){if(t[e]){return r(e)}else{return i(e,n)}};s.modelRemove=function(e){t[e]=null};s.receiveRemove=function(e){for(var n in t){t[n].receiveRemove()}};window.Marilyn=s})()